<?xml version="1.0" encoding="UTF-8"?>

<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xmlns:cxf="http://camel.apache.org/schema/blueprint/cxf"
           xsi:schemaLocation="
             http://www.osgi.org/xmlns/blueprint/v1.0.0 https://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd
             http://camel.apache.org/schema/blueprint/cxf http://camel.apache.org/schema/cxf/camel-cxf.xsd
             http://camel.apache.org/schema/blueprint http://camel.apache.org/schema/blueprint/camel-blueprint.xsd
             ">
    <bean id="amq" class="org.apache.activemq.camel.component.ActiveMQComponent">
        <property name="brokerURL" value="tcp://localhost:61616"/>
        <property name="userName" value="Username" />
        <property name="password" value="Password" />
    </bean>

    <bean id="userServiceToUserDataConverter" class="com.cameltraining.aggragatesample.UserServiceRequestToUserDataConverter"></bean>
    <cxf:rsServer id="sampleService" address="http://localhost:8383" serviceClass="com.cameltraining.aggragatesample.ISampleService">
    </cxf:rsServer>
    <camelContext id="camel-context" xmlns="http://camel.apache.org/schema/blueprint">
        <dataFormats>
            <json id="gson" library="Gson"/>
        </dataFormats>
        <route id="inbound-route">
            <from uri="cxfrs:bean:sampleService?bindingStyle=SimpleConsumer"/>
            <convertBodyTo type="com.cameltraining.aggragatesample.UserData"></convertBodyTo>
            <marshal ref="gson"></marshal>
            <log message="\nheaders===>${headers}\n"></log>
            <log message="\nbody===>${body}\n"></log>
            <wireTap uri="amq:userServiceQueue:received"></wireTap>
            <transform>
                <constant>OK</constant>
            </transform>
        </route>
        <route id="aggragate-route">
            <from uri="amq:userServiceQueue:received"></from>
            <log message="###AMQ### ${body}"></log>
        </route>
    </camelContext>
</blueprint>