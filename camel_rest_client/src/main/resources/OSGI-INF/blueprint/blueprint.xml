<?xml version="1.0" encoding="UTF-8"?>

<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xmlns:jaxrs="http://cxf.apache.org/jaxrs"
           xmlns:cxf="http://camel.apache.org/schema/blueprint/cxf"
           xsi:schemaLocation="
             http://www.osgi.org/xmlns/blueprint/v1.0.0 https://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd
             http://camel.apache.org/schema/blueprint http://camel.apache.org/schema/blueprint/camel-blueprint.xsd
             ">
    <bean id="console" class="com.cameltraining.restclient.ConsoleLogProcessor"></bean>
    <bean id="invoker" class="com.cameltraining.restclient.RecurringJobBean"></bean>
    <bean id="toStringBean" class="com.cameltraining.restclient.MessageToStringBean"></bean>
    <bean id="jsonProvider" class="org.apache.cxf.jaxrs.provider.json.JSONProvider"/>
    <cxf:rsClient id="cxfProducer"
                  address="http://localhost:8585/"
                  serviceClass="com.cameltraining.restclient.GreetingService"
                  loggingFeatureEnabled="true">
        <cxf:providers>
            <ref component-id="jsonProvider" />
        </cxf:providers>
    </cxf:rsClient>
    <cxf:rsClient id="rsClient" address="http://freegeoip.net"
                  serviceClass="com.cameltraining.restclient.Freegeoip"
                  loggingFeatureEnabled="true"/>
    <bean id="requestProcessor" class="com.cameltraining.restclient.RequestProcessor"></bean>
<camelContext id="camel-context" xmlns="http://camel.apache.org/schema/blueprint">
        <route>
            <from uri="timer://foo?period=5000"/>
            <log message="Starting Route with client proxy api"/>
            <setHeader headerName="type">
                <constant>xml</constant>
            </setHeader>
            <setBody>
                <constant>0.0.0.0</constant>
            </setBody>
            <process ref="requestProcessor"/>
            <to uri="cxfrs:bean:rsClient"/>
            <process ref="console"></process>
        </route>
    </camelContext>

</blueprint>